window._promisesPolyfill=function(a){"use strict";var b,c,d=!1,e=a,f=e.MutationObserver||e.WebKitMutationObserver;if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))b=function(a,b){process.nextTick(function(){a.call(b)})};else if(f){var g=[],h=new f(function(){var a=g.slice();g=[],a.forEach(function(a){a[0].call(a[1])})}),i=document.createElement("div");h.observe(i,{attributes:!0}),window.addEventListener("unload",function(){h.disconnect(),h=null}),b=function(a,b){g.push([a,b]),i.setAttribute("drainQueue","drainQueue")}}else b=function(a,b){setTimeout(function(){a.call(b)},1)};var j=function(a){return{enumerable:!0,configurable:!1,get:a}},k=function(a,b,c,d){return{enumerable:!!b,configurable:!0,writable:!0,value:a||function(){}}},l=function(a){return k(a,0,1,0)},m=function(a){return k(a,1)},n=function(a){try{var b=a.then;if("function"==typeof b)return!0}catch(a){}return!1},o=function(a){Error.call(this,a)};o.prototype=Object.create(Error.prototype);var p=function(){var a=[];return a.pump=function(c){b(function(){for(var b=a.length,d=0;d<b;)d++,a.shift()(c)})},a},q=function(a,c,e,f,g,h){var i=!1,k=this,l=function(a){b(function(){h("fulfilled"),f(a),c.pump(a)})},m=function(a){b(function(){h("rejected"),g(a),e.pump(a)})},o=function(a){return n(a)?void a.then(o,m):void l(a)},p=function(a,b){return function(b){i?"undefined"!=typeof console&&console.error("Cannot resolve a Promise multiple times."):(i=!0,a(b))}};this.resolve=p(o,"resolve"),this.fulfill=p(l,"fulfill"),this.reject=p(m,"reject"),this.cancel=function(){k.reject(new Error("Cancel"))},this.timeout=function(){k.reject(new Error("Timeout"))},d&&Object.defineProperties(this,{_isResolved:j(function(){return i})}),h("pending")},c=function(a){var b,c,e=new p,f=new p,g="pending";d&&Object.defineProperties(this,{_value:j(function(){return b}),_error:j(function(){return c}),_state:j(function(){return g})}),Object.defineProperties(this,{_addAcceptCallback:l(function(a){e.push(a),"fulfilled"==g&&e.pump(b)}),_addRejectCallback:l(function(a){f.push(a),"rejected"==g&&f.pump(c)})});var h=new q(this,e,f,function(a){b=a},function(a){c=a},function(a){g=a});try{a&&a(h)}catch(a){h.reject(a)}},r=function(a){return"function"==typeof a},s=function(a,b,c){return r(a)?function(){try{var c=a.apply(null,arguments);b.resolve(c)}catch(a){b.reject(a)}}:b[c].bind(b)},t=function(a,b,c){return r(a)&&c._addAcceptCallback(a),r(b)&&c._addRejectCallback(b),c};c.prototype=Object.create(null,{then:m(function(a,b){var d=this;return new c(function(c){t(s(a,c,"resolve"),s(b,c,"reject"),d)})}),catch:m(function(a){var b=this;return new c(function(c){t(null,s(a,c,"reject"),b)})})}),c.isThenable=n;var u=function(a){return Array.prototype.slice.call(a).map(c.resolve)};c.any=function(){var a=u(arguments);return new c(function(b){if(a.length){var c=!1,d=function(a){c||(c=!0,b.resolve(a))},e=function(a){c||(c=!0,b.reject(a))};a.forEach(function(a,b){a.then(d,e)})}else b.reject("No futures passed to Promise.any()")})},c.every=function(){var a=u(arguments);return new c(function(b){if(a.length){var c=new Array(a.length),d=0,e=function(e,f){d++,c[e]=f,d==a.length&&b.resolve(c)};a.forEach(function(a,c){a.then(e.bind(null,c),b.reject)})}else b.reject("No futures passed to Promise.every()")})},c.some=function(){var a=u(arguments);return new c(function(b){if(a.length){var c=0,d=function(d){c++,c==a.length&&b.reject()};a.forEach(function(a,c){a.then(b.resolve,d)})}else b.reject("No futures passed to Promise.some()")})},c.fulfill=function(a){return new c(function(b){b.fulfill(a)})},c.resolve=function(a){return new c(function(b){b.resolve(a)})},c.reject=function(a){return new c(function(b){b.reject(a)})},a.Promise=c},window._asyncLocalStorage=function(a,b){"use strict";if("undefined"!=typeof a.window&&a.window===a&&"undefined"!=typeof a.indexedDB){var c="async_local_storage",d="als_objects",e=1,f=null,g={};g.tail=new Promise(function(a){a.fulfill()}),g.add=function(a,b){var c=g.tail,d=function(){return q().then(function(){var c=new Promise(function(b){n(a,b)});return b===!0?c:new Promise(function(a){var b=a.fulfill.bind(a);setTimeout(function(){c.then(b,b)},1)})})};return g.tail=c.then(d,d)};var h,i,j,k=function(a){return a},l=function(){h=null,i=null},m=b.userAgent.match(/Firefox\/\d+(\.\d+)/)instanceof Array,n=function(a,b){var c=a.operation,e=a.transform||k;if(m&&h&&i)try{i.count()}catch(a){console.log("  store.count failed = ("),console.log("  clearTrans();"),l()}h||(h=f.transaction([d],"readwrite"),i=h.objectStore(d),h.onabort=h.onerror=h.oncomplete=l);var g=null,j=function(a){b.resolve(e(a))},n=function(a){b.reject(a)};switch(c){case"get":g=i.get(a.key);break;case"set":g=i.put(a.value,a.key);break;case"delete":g=i.delete(a.key);break;case"clear":g=i.clear();break;case"has":g=i.count(a.key);break;case"count":g=i.count();break;case"forEach":return g=i.openCursor(),g.onsuccess=function(b){var c=b.target.result;if(c){try{a.callback.call(a.scope||null,c.value,c.key)}catch(a){return void n(a)}c.continue()}else j()},void(g.onerror=n)}return g?(g.onsuccess=function(){j(g.result)},void(g.onerror=n)):void n(new Error("IDB Request Failed"))},o=!1,p=new Promise(function(a){j=a}),q=function(){if(o)return p;o=!0;var b=a.indexedDB.open(c,e);return b.onupgradeneeded=function(a){f=a.target.result,f.createObjectStore(d)},b.onsuccess=function(a){f=a.target.result,j.resolve(a)},b.onfailure=j.reject.bind(j),p},r=function(a){return{configurable:!0,enumerable:!1,writable:!1,value:a}},s=b.alsPolyfillStorage=Object.create(null,{has:r(function(a){return g.add({operation:"has",key:a,transform:function(a){return!!a}})}),set:r(function(a,b){return g.add({operation:"set",key:a,value:b})}),get:r(function(a){return g.add({operation:"get",key:a})}),delete:r(function(a){return g.add({operation:"delete",key:a})}),clear:r(function(){return g.add({operation:"clear"})}),count:r(function(){return g.add({operation:"count"})}),forEach:r(function(a,b){return g.add({operation:"forEach",callback:function(b,c){a(b,c,s)},scope:b},!0)})})}},function(a,b){"use strict";if("undefined"==typeof a.indexedDB)return!1;if("undefined"==typeof a.Worker||!a.Worker)return!1;if("undefined"==typeof a._promisesPolyfill)return!1;if(a._promisesPolyfill(a),"undefined"==typeof a._asyncLocalStorage)return!1;a._asyncLocalStorage(a,a.navigator||{});var c={storage:navigator.storage||navigator.alsPolyfillStorage,prefix:"abtf-",default_expire:86400,isValidItem:null,timeout:5e3,now:function(){return+new Date/1e3},saveScript:function(a,b,d){var e={},f=this.now();e.data=b,e.date=f,e.expire=f+(d||c.default_expire),this.add(a,e)},getScript:function(a){return new Promise(function(b,e){console.log("x2"),c.get(a).then(function(a){return console.log("x3",a),cacheObject?"undefined"!=typeof cacheObject.expire&&cacheObject.expire-this.now()<0?e():void b(d(cacheObject.data,"application/javascript")):e()},e)})},add:function(a,b){return new Promise(function(d,e){try{return c.storage.set(c.prefix+a,b).then(d,e),!0}catch(a){e()}})},remove:function(a){c.storage.delete(c.prefix+a)},get:function(a){return c.storage.get(c.prefix+a)},clear:function(a){var b=this.now();c.storage.forEach(function(d,e){console.log(e,d,typeof d,d.expire),e&&(!a||d.expire<=b)&&c.storage.delete(e)})}},d=function(b,c){var d;try{d=new Blob([b],{type:c})}catch(e){a.BlobBuilder=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,d=new BlobBuilder,d.append(b),d=d.getBlob(c)}return URL.createObjectURL(d)};console.log("start"),c.storage.set("test").then(function(){console.log(123),c.storage.get("test").then(function(a){console.log("get:",a)},function(){console.error("x")})});var e=function(){self.FETCH=self.fetch||!1,self.DEFAULT_TIMEOUT=5e3,!"{{PROMISES}}"(self),!"{{IDB}}"(self,self.navigator||{});var a=function(a){var b=!1,c=function(c,d){b||(b=!0,f&&(clearTimeout(f),f=!1),RESOURCE_LOAD_COMPLETED(a,c,d))};if(FETCH){var d={method:"GET",mode:"cors",cache:"default"};FETCH(a.url,d).then(function(a){b||(a.ok?a.text().then(function(a){c(!1,a)}):c(a.error()))}).catch(function(a){b||c(a)});var e=a.timeout||DEFAULT_TIMEOUT;isNaN(e)&&(e=DEFAULT_TIMEOUT);var f=setTimeout(function(){b||c("timeout")},e)}else{var g=new XMLHttpRequest;g.open("GET",a.url,!0),g.responseType="text",g.onreadystatechange=function(){b||4===g.readyState&&(200!==g.status?c(g.statusText):c(!1,g.responseText))},g.onerror=function(){b||c(g.statusText)};var e=a.timeout||DEFAULT_TIMEOUT;isNaN(e)&&(e=DEFAULT_TIMEOUT);var f=setTimeout(function(){if(!b){try{g.abort()}catch(a){}c("timeout")}},e);g.send(null)}};self.RESOURCE_LOAD_COMPLETED=function(a,b,c){b?self.postMessage([2,a.i,b]):self.postMessage([1,a.i,c])},self.onmessage=function(b){var c=b.data;if(c instanceof Array)for(var d=c.length,e=0;e<d;e++)"object"==typeof c[e]&&"undefined"!=typeof c[e].url&&"undefined"!=typeof c[e].i&&a(c[e]);else{if("object"!=typeof c||"undefined"==typeof c.url||"undefined"==typeof c.i)throw new Error("Web Worker Script Loader: Invalid resource object");a(c)}}}.toString().replace(/"\{\{PROMISES\}\}"/,a._promisesPolyfill.toString()).replace(/"\{\{IDB\}\}"/,a._asyncLocalStorage.toString()).replace(/^function\s*\(\s*\)\s*\{/,"").replace(/\}$/,""),f={workerUri:d(e,"application/javascript"),worker:!1,scriptIndex:0,scriptQueue:[],start:function(){this.worker=new Worker(this.workerUri),this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)},stop:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessage),this.worker.removeEventListener("error",this.handleError),this.worker.terminate(),this.worker=!1,console.warn("Abtf.js() ➤ web worker terminated"))},handleMessage:function(a){var b=a.data,c=b[1];return"undefined"==typeof f.scriptQueue[c]?void console.error("Abtf.js() ➤ web worker script loader invalid response",b):1===parseInt(b[0])?void f.scriptQueue[c].onData(b[2]):2===parseInt(b[0])?void console.error("Abtf.js() ➤ web worker script loader error",b[2]):void 0},handleError:function(a){console.error("Abtf.js() ➤ web worker script loader error",a)},loadScript:function(b){return this.worker||this.start(),new Promise(function(c,d){b=a.Abtf.proxifyScript(b);var e=parseInt(f.scriptIndex);f.scriptIndex++,f.scriptQueue[e]={url:b,onData:c,onError:d},f.worker.postMessage({url:b,i:e})})}};f.start(),a.addEventListener("beforeunload",function(a){f.stop()}),c.clear(!0),a.Abtf.loadCachedScript=function(a,d,e){console.log("logad 1"),c.getScript(a).then(function(a){console.log("logad 2"),b.loadScript(a,d,e)},function(){console.log("logad 3"),b.loadScript(a,function(){f.loadScript(a).then(function(d){return d?(console.info("Abtf.js() ➤ web worker script loader saved",b.localUrl(a)),void c.saveScript(a,d)):void console.error("Abtf.js() ➤ web worker script loader no data",b.localUrl(a))})},e)})},a.Abtf.cachedScriptUrl=function(a){return new Promise(function(d,e){c.getScript(a).then(d,function(){f.loadScript(a).then(function(d){return d?(console.info("Abtf.js() ➤ web worker script loader saved",b.localUrl(a)),void c.saveScript(a,d)):void console.error("Abtf.js() ➤ web worker script loader no data",b.localUrl(a))})})})}}(window,window.Abtf);