!function(a,b){var c,d,e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!1,l=!1,m=[],n=[],o=[],p={},q=[];a.Abtf.proxy_setup=function(a){if("undefined"==typeof b)var b=!1;if(c=a.url||b,c||console.error("Abtf.proxy()","no proxy url",a),e=a.js||!1,f=a.css||!1,g=a.cdn||!1,g&&q.push(g),h=a.js_include||!1,i=a.js_exclude||!1,j=a.css_include||!1,k=a.css_exclude||!1,a.preload){l=!0;for(var r=0;r<a.preload.length;r++)"regex"===a.preload[r][0]?(o.push([a.preload[r][2],a.preload[r][3],a.preload[r][1]]),a.preload[r][4]&&(p[a.preload[r][0]]=a.preload[r][4],q.indexOf(a.preload[r][4])===-1&&q.push(a.preload[r][4]))):(m.push(a.preload[r][0]),n.push(a.preload[r][1]),a.preload[r][4]&&(p[a.preload[r][0]]=a.preload[r][4],q.indexOf(a.preload[r][4])===-1&&q.push(a.preload[r][4])));d=a.base||!1}if(0===q.length)q=!1;else for(var s=q.length,r=0;r<s;r++)q[r]=v(q[r])};var r={Element:"undefined"!=typeof Element&&Element,Document:"undefined"!=typeof Document&&Document},s={append:{},insert:{}};for(var t in r)r.hasOwnProperty(t)&&r[t]&&(s.append[t]=r[t].prototype.appendChild,s.insert[t]=r[t].prototype.insertBefore);var u=document.createElement("a");u.href=document.location.href;var v=function(a){var b=document.createElement("a");return b.href=a,b},w=function(a,b){return"css"===b?c.replace("{PROXY:URL}",escape(a)).replace("{PROXY:TYPE}",escape(b)):"js"===b?c.replace("{PROXY:URL}",escape(a)).replace("{PROXY:TYPE}",escape(b)):void 0},x=function(a,c,e){var f,g=!1;if(l){var h=m.indexOf(a);if(h>-1)var i=n[h];else if(o.length>0)for(var j,k,q=o.length,r=0;r<q;r++){k=!1;try{j=new RegExp(o[r][0],o[r][1]||"")}catch(a){k=!0}if(!k&&j.test(a)){g=!0,f=a,o[r][2]?i=o[r][2]:o[r][3]&&(a=o[r][3]);break}}if(i){if("undefined"!=typeof p[a])var s=p[a];else var s=d;s+=i.substr(0,2)+"/",s+=i.substr(2,2)+"/",s+=i.substr(4,2)+"/",s+=i.substr(6,2)+"/",s+=i.substr(8,2)+"/",s+=i;if("js"===c){if(s+=".js","undefined"!=typeof b.cachedScriptUrl){var t=v(s).href;return void b.cachedScriptUrl(t).then(function(a){a!==u&&(g?console.log("Abtf.proxy()","cached regex capture",b.localUrl(f),"➤","cache:"+i,"➤",a):console.log("Abtf.proxy()","cached capture",b.localUrl(u),"➤","cache:"+i,"➤",a)),e(a)})}}else"css"===c&&(s+=".css");return g?console.log("Abtf.proxy()","regex capture",b.localUrl(f),"➤","cache:"+i):console.log("Abtf.proxy()","capture",b.localUrl(a),"➤","cache:"+i),e(s)}}if("js"===c&&"undefined"!=typeof b.cachedScriptUrl){var u=v(a).href;return void b.cachedScriptUrl(u).then(function(a){a!==u?(g?console.log("Abtf.proxy()","cached regex capture",b.localUrl(f),"regex","➤",b.localUrl(u),"➤",a):console.log("Abtf.proxy()","cached capture",b.localUrl(u),"➤",a),e(a)):e(w(a,c))})}g?console.log("Abtf.proxy()","capture",b.localUrl(f),"regex","➤",a):console.log("Abtf.proxy()","capture",b.localUrl(a)),e(w(a,c))},y=function(a,c){var d=v(a);if("blob:"===d.protocol)return!1;if(q&&c!==!0)for(var e=q.length,f=0;f<e;f++)if(d.href.indexOf(q[f].href)!==-1)return!1;if(d.host===u.host)return!1;if(h){for(var g=!1,e=h.length,f=0;f<e;f++)if(d.href.indexOf(h[f])!==-1){g=!0;break}if(!g)return console.log("Abtf.proxy()","ignore",b.localUrl(d.href),"not on include list"),!1}if(i)for(var e=i.length,f=0;f<e;f++)if(d.href.indexOf(i[f])!==-1)return console.log("Abtf.proxy()","ignore",b.localUrl(d.href),"on exclude list:",i[f]),!1;return!0},z=function(a){var c=v(a);if("blob:"===c.protocol)return!1;if(q)for(var d=q.length,e=0;e<d;e++)if(c.href.indexOf(q[e].href)!==-1)return!1;if(c.host===u.host)return!1;if(j){for(var f=!1,d=j.length,e=0;e<d;e++)if(c.href.indexOf(j[e])!==-1){f=!0;break}if(!f)return console.log("Abtf.proxy()","ignore",b.localUrl(c.href),"not on include list"),!1}if(k)for(var d=k.length,e=0;e<d;e++)if(c.href.indexOf(k[e])!==-1)return console.log("Abtf.proxy()","ignore",b.localUrl(c.href),"on exclude list:",k[e]),!1;return!0},A=function(a){if(a.nodeName)if("SCRIPT"===a.nodeName.toUpperCase()){if(!e)return!1;if(a.src)return!!y(a.src)&&"js"}else if("LINK"===a.nodeName.toUpperCase()&&"stylesheet"===a.rel.toLowerCase()){if(!f)return!1;if(a.href)return!!z(a.href)&&"css"}return!1},B=function(a,b){var c=A(a);if(!c)return!1;var d=v("css"===c?a.href:a.src).href;x(d,c,function(d){"css"===c?a.href=d:"js"===c&&(a.src=d),b()})},C={appendChild:function(a,b){var c=this;return B(b,function(){s.append[a].call(c,b)}),b},insertBefore:function(a,b,c){var d=this;return B(b,function(){s.insert[a].call(d,b,c)}),b}};for(var t in r)r.hasOwnProperty(t)&&r[t]&&!function(a){r[a].prototype.appendChild=function(b){return C.appendChild.call(this,a,b)},r[a].prototype.insertBefore=function(b,c){return C.insertBefore.call(this,a,b,c)}}(t);a.Abtf.proxifyScript=function(a){return y(a,!0)?w(a,"js"):a}}(window,window.Abtf);