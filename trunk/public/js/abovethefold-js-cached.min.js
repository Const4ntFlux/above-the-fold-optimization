!function(a,b){"use strict";if("undefined"==typeof a.indexedDB)return!1;if("undefined"==typeof a.Worker||!a.Worker)return!1;if("undefined"==typeof a._promisesPolyfill)return!1;if(a._promisesPolyfill(a),"undefined"==typeof a._asyncLocalStorage)return!1;a._asyncLocalStorage(a,a.navigator||{});var c={storage:navigator.storage||navigator.alsPolyfillStorage,prefix:"abtf-",default_expire:86400,isValidItem:null,timeout:5e3,now:function(){return+new Date/1e3},saveScript:function(a,b,d){var e={},f=this.now();e.data=b,e.date=f,e.expire=f+(d||c.default_expire),this.add(a,e)},getScript:function(a){return new Promise(function(b,e){console.log("x2"),c.get(a).then(function(a){return console.log("x3",a),cacheObject?"undefined"!=typeof cacheObject.expire&&cacheObject.expire-this.now()<0?e():void b(d(cacheObject.data,"application/javascript")):e()},e)})},add:function(a,b){return new Promise(function(d,e){try{return c.storage.set(c.prefix+a,b).then(d,e),!0}catch(a){e()}})},remove:function(a){c.storage.delete(c.prefix+a)},get:function(a){return c.storage.get(c.prefix+a)},clear:function(a){var b=this.now();c.storage.forEach(function(d,e){console.log(e,d,typeof d,d.expire),e&&(!a||d.expire<=b)&&c.storage.delete(e)})}},d=function(b,c){var d;try{d=new Blob([b],{type:c})}catch(e){a.BlobBuilder=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,d=new BlobBuilder,d.append(b),d=d.getBlob(c)}return URL.createObjectURL(d)};console.log("start"),c.storage.set("test").then(function(){console.log(123),c.storage.get("test").then(function(a){console.log("get:",a)},function(){console.error("x")})});var e=function(){self.FETCH=self.fetch||!1,self.DEFAULT_TIMEOUT=5e3,!"{{PROMISES}}"(self),!"{{IDB}}"(self,self.navigator||{});var a=function(a){var b=!1,c=function(c,d){b||(b=!0,f&&(clearTimeout(f),f=!1),RESOURCE_LOAD_COMPLETED(a,c,d))};if(FETCH){var d={method:"GET",mode:"cors",cache:"default"};FETCH(a.url,d).then(function(a){b||(a.ok?a.text().then(function(a){c(!1,a)}):c(a.error()))}).catch(function(a){b||c(a)});var e=a.timeout||DEFAULT_TIMEOUT;isNaN(e)&&(e=DEFAULT_TIMEOUT);var f=setTimeout(function(){b||c("timeout")},e)}else{var g=new XMLHttpRequest;g.open("GET",a.url,!0),g.responseType="text",g.onreadystatechange=function(){b||4===g.readyState&&(200!==g.status?c(g.statusText):c(!1,g.responseText))},g.onerror=function(){b||c(g.statusText)};var e=a.timeout||DEFAULT_TIMEOUT;isNaN(e)&&(e=DEFAULT_TIMEOUT);var f=setTimeout(function(){if(!b){try{g.abort()}catch(a){}c("timeout")}},e);g.send(null)}};self.RESOURCE_LOAD_COMPLETED=function(a,b,c){b?self.postMessage([2,a.i,b]):self.postMessage([1,a.i,c])},self.onmessage=function(b){var c=b.data;if(c instanceof Array)for(var d=c.length,e=0;e<d;e++)"object"==typeof c[e]&&"undefined"!=typeof c[e].url&&"undefined"!=typeof c[e].i&&a(c[e]);else{if("object"!=typeof c||"undefined"==typeof c.url||"undefined"==typeof c.i)throw new Error("Web Worker Script Loader: Invalid resource object");a(c)}}}.toString().replace(/"\{\{PROMISES\}\}"/,a._promisesPolyfill.toString()).replace(/"\{\{IDB\}\}"/,a._asyncLocalStorage.toString()).replace(/^function\s*\(\s*\)\s*\{/,"").replace(/\}$/,""),f={workerUri:d(e,"application/javascript"),worker:!1,scriptIndex:0,scriptQueue:[],start:function(){this.worker=new Worker(this.workerUri),this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)},stop:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessage),this.worker.removeEventListener("error",this.handleError),this.worker.terminate(),this.worker=!1)},handleMessage:function(a){var b=a.data,c=b[1];if("undefined"!=typeof f.scriptQueue[c])return 1===parseInt(b[0])?void f.scriptQueue[c].onData(b[2]):void(2===parseInt(b[0]))},handleError:function(a){},loadScript:function(b){return this.worker||this.start(),new Promise(function(c,d){b=a.Abtf.proxifyScript(b);var e=parseInt(f.scriptIndex);f.scriptIndex++,f.scriptQueue[e]={url:b,onData:c,onError:d},f.worker.postMessage({url:b,i:e})})}};f.start(),a.addEventListener("beforeunload",function(a){f.stop()}),c.clear(!0),a.Abtf.loadCachedScript=function(a,d,e){console.log("logad 1"),c.getScript(a).then(function(a){console.log("logad 2"),b.loadScript(a,d,e)},function(){console.log("logad 3"),b.loadScript(a,function(){f.loadScript(a).then(function(b){b&&c.saveScript(a,b)})},e)})},a.Abtf.cachedScriptUrl=function(a){return new Promise(function(b,d){c.getScript(a).then(b,function(){f.loadScript(a).then(function(b){b&&c.saveScript(a,b)})})})}}(window,window.Abtf);